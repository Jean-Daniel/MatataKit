//
//  MatataCoreTests.swift
//  MatataCoreTests
//
//  Created by Jean-Daniel Dupas
//

import XCTest
@testable import MatataCore

class MatataCoreTests: XCTestCase {

    func testHandshake() throws {
        // Not in sensor mode
        XCTAssertEqual(try IO.encode([0x4, 0x88, 0x7]), [0xfe, 0x4, 0x88, 0x7, 0xf2, 0x8a])
        
        XCTAssertEqual(.ok, try Handshake.parse(response: [0xfe, 0x06, 0x7e, 0x2, 0x0, 0x0, 0x52, 0xc6]))
    }

    func testCRC() throws {
        XCTAssertEqual([0xfe, 0x06, 0x7e, 0x2, 0x0, 0x0, 0x52, 0xc6],
                       try IO.encode(IO.decode([0xfe, 0x06, 0x7e, 0x2, 0x0, 0x0, 0x52, 0xc6])))
        
        XCTAssertEqual([0xfe, 0x07, 0x7e, 0x2, 0x2, 0x0, 0x0, 0x97, 0x77],
                       try IO.encode(IO.decode([0xfe, 0x07, 0x7e, 0x2, 0x2, 0x0, 0x0, 0x97, 0x77])))
    }
}
