//
//  MatataCoreTests.swift
//  MatataCoreTests
//
//  Created by Jean-Daniel Dupas
//

import XCTest
@testable import MatataCore

class MatataCoreTests: XCTestCase {

    func testHandshake() throws {
        // Not in sensor mode
        XCTAssertEqual(try IO.encode([0x4, 0x88, 0x7]), Data([0xfe, 0x4, 0x88, 0x7, 0xf2, 0x8a]))
        
        XCTAssertEqual(.ok, try Handshake.parse(payload: Data([0x06, 0x7e, 0x2, 0x0, 0x0])))
    }

    func testCRC() throws {
        XCTAssertEqual(Data([0xfe, 0x06, 0x7e, 0x2, 0x0, 0x0, 0x52, 0xc6]),
                       try IO.encode(IO.decode([0xfe, 0x06, 0x7e, 0x2, 0x0, 0x0, 0x52, 0xc6])))
        
        XCTAssertEqual(Data([0xfe, 0x07, 0x7e, 0x2, 0x2, 0x0, 0x0, 0x97, 0x77]),
                       try IO.encode(IO.decode([0xfe, 0x07, 0x7e, 0x2, 0x2, 0x0, 0x0, 0x97, 0x77])))
    }
    
    func testShowSingle() {
        var data: [UInt8] = [0x18, 0x08, 0x00, 0x00, 0x00, 0x00]
        data[2] = 0 // index - 1
        data[3] = 0 // r
        data[4] = 0 // g
        data[5] = 255 // b
        XCTAssertEqual(Data([0xfe, 0x08, 0x18, 0x08, 0x00, 0x00, 0x00, 0xff, 0x69, 0x78]), try IO.encode(data, withLength: true))
    }
}
